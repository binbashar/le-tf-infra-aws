version: 3

autodiscover:
  mode: "enabled"
  ignore_paths:
  - config/*

workflows:
  default:
    # Customize plan command
    plan:
      steps:
      # Run init before plan
      - run:
          # command: leverage tf init
          command: tofu init -backend-config=../../config/backend.tfvars
          # output: show

      # You MUST output the plan using -out $PLANFILE because Atlantis expects
      # plans to be in a specific location.
      - run:
          # command: leverage tf plan -input=false -refresh -out $PLANFILE
          command: tofu plan -var-file=../../config/backend.tfvars -var-file=../../../config/common.tfvars -var-file=../../config/account.tfvars -input=false -refresh -out $PLANFILE

    # Customize apply command
    apply:
      steps:
      # Again, you must use the $PLANFILE environment variable.
      - run: leverage tf apply $PLANFILE

projects:
- name: test
  dir: shared/us-east-1/base-tf-backend
  terraform_distribution: opentofu
  terraform_version: 1.6.6
  workflow: leverage
